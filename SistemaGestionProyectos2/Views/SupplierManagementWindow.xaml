<Window x:Class="SistemaGestionProyectos2.Views.SupplierManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        Title="Gestión de Proveedores" 
        Height="600" 
        Width="1100"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        WindowStyle="None"
        ResizeMode="NoResize">

    <Window.Resources>
        <!-- Estilos heredados de ExpenseManagementWindow -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#2196F3"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="38"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                CornerRadius="5"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#1976D2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="#FFF"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#F5F5F5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button">
            <Setter Property="Background" Value="#F44336"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#D32F2F"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SuccessButton" TargetType="Button">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#388E3C"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo para fila nueva -->
        <Style x:Key="NewRowStyle" TargetType="DataGridRow">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsNew}" Value="True">
                    <Setter Property="Background" Value="#E8F5E9"/>
                    <Setter Property="BorderBrush" Value="#4CAF50"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </DataTrigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3F2FD"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#BBDEFB"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#1976D2" Offset="0"/>
                    <GradientStop Color="#1565C0" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid Height="60">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0">
                    <TextBlock Text="🚚" FontSize="24" Foreground="White" Margin="0,0,10,0"/>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="GESTIÓN DE PROVEEDORES" 
                                 FontSize="20" 
                                 FontWeight="Bold" 
                                 Foreground="White"/>
                        <TextBlock Text="Administración de proveedores y días de crédito"
                                 Foreground="#E3F2FD"
                                 FontSize="11"/>
                    </StackPanel>
                </StackPanel>

                <Button Grid.Column="1" 
                        Name="CloseButton"
                        Background="#37474F"
                        Foreground="White"
                        BorderThickness="0"
                        Padding="15,8"
                        Margin="0,0,20,0"
                        Height="35"
                        Width="100"
                        Cursor="Hand"
                        Click="CloseButton_Click">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="← " FontSize="14" Margin="0,0,5,0"/>
                        <TextBlock Text="VOLVER" FontSize="12" FontWeight="SemiBold"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="White" Padding="15,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal">
                    <!-- Búsqueda -->
                    <Border Background="#F5F5F5" CornerRadius="5" Width="300">
                        <Grid>
                            <TextBox Name="SearchBox"
                                   BorderThickness="0"
                                   Background="Transparent"
                                   Padding="35,8,10,8"
                                   FontSize="14"
                                   TextChanged="SearchBox_TextChanged"
                                   VerticalAlignment="Center"/>
                            <TextBlock Text="🔍"
                                     HorizontalAlignment="Left"
                                     VerticalAlignment="Center"
                                     Margin="10,0,0,0"
                                     Foreground="#666"
                                     IsHitTestVisible="False"/>
                            <TextBlock Text="Buscar proveedor..."
                                     HorizontalAlignment="Left"
                                     VerticalAlignment="Center"
                                     Margin="35,0,0,0"
                                     Foreground="#999"
                                     IsHitTestVisible="False">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Text, ElementName=SearchBox}" Value="">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>
                    </Border>

                    <!-- Filtro Estado -->
                    <ComboBox Name="StatusFilterCombo"
                            Width="150"
                            Height="38"
                            Margin="15,0,0,0"
                            FontSize="14"
                            SelectionChanged="StatusFilterCombo_SelectionChanged">
                        <ComboBoxItem IsSelected="True">Todos</ComboBoxItem>
                        <ComboBoxItem>Activos</ComboBoxItem>
                        <ComboBoxItem>Inactivos</ComboBoxItem>
                    </ComboBox>
                </StackPanel>

                <!-- Botón Nuevo -->
                <Button Grid.Column="1"
                        Name="NewSupplierButton"
                        Content="➕ NUEVO PROVEEDOR"
                        Style="{StaticResource ModernButton}"
                        Width="160"
                        Click="NewSupplierButton_Click"/>
            </Grid>
        </Border>

        <!-- DataGrid con edición inline -->
        <Border Grid.Row="2" Background="White" Margin="15">
            <DataGrid Name="SuppliersDataGrid"
                            AutoGenerateColumns="False"
                            CanUserAddRows="False"
                            CanUserDeleteRows="False"
                            CanUserSortColumns="True"
                            GridLinesVisibility="Horizontal"
                            BorderThickness="1"
                            BorderBrush="#E0E0E0"
                            HeadersVisibility="Column"
                            FontSize="13"
                            RowHeight="45"
                            AlternatingRowBackground="#FAFAFA"
                            SelectionMode="Single"
                            RowStyle="{StaticResource NewRowStyle}">

                <DataGrid.Resources>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#F5F5F5"/>
                        <Setter Property="Foreground" Value="#333"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Height" Value="40"/>
                        <Setter Property="Padding" Value="10,0"/>
                        <Setter Property="BorderBrush" Value="#E0E0E0"/>
                        <Setter Property="BorderThickness" Value="0,0,1,1"/>
                    </Style>
                </DataGrid.Resources>
                
                <DataGrid.Columns>
                    <!-- Nombre - EDITABLE -->
                    <DataGridTextColumn Header="NOMBRE DEL PROVEEDOR" 
                          Binding="{Binding SupplierName, UpdateSourceTrigger=PropertyChanged}"
                          Width="2.5*"
                          CanUserSort="True"
                          SortMemberPath="SupplierName">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="10,0"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                        <DataGridTextColumn.EditingElementStyle>
                            <Style TargetType="TextBox">
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="8,5"/>
                            </Style>
                        </DataGridTextColumn.EditingElementStyle>
                    </DataGridTextColumn>

                    <!-- RFC - EDITABLE -->
                    <DataGridTextColumn Header="RFC" 
                          Binding="{Binding TaxId, UpdateSourceTrigger=PropertyChanged}"
                          Width="140"
                          CanUserSort="True"
                          SortMemberPath="TaxId">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Teléfono - EDITABLE -->
                    <DataGridTextColumn Header="TELÉFONO" 
                          Binding="{Binding Phone, UpdateSourceTrigger=PropertyChanged}"
                          Width="130"
                          CanUserSort="True"
                          SortMemberPath="Phone">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Email - EDITABLE -->
                    <DataGridTextColumn Header="EMAIL" 
                          Binding="{Binding Email, UpdateSourceTrigger=PropertyChanged}"
                          Width="1.5*"
                          CanUserSort="True"
                          SortMemberPath="Email">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="5,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Días de Crédito - EDITABLE -->
                    <DataGridTemplateColumn Header="DÍAS CRÉDITO" 
                              Width="100"
                              CanUserSort="True"
                              SortMemberPath="CreditDays">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding CreditDays}"
                                         HorizontalAlignment="Center"
                                         VerticalAlignment="Center"
                                         FontWeight="Bold">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#333"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CreditDays}" Value="0">
                                                    <Setter Property="Foreground" Value="#F44336"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        <DataGridTemplateColumn.CellEditingTemplate>
                            <DataTemplate>
                                <TextBox Text="{Binding CreditDays, UpdateSourceTrigger=PropertyChanged}"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       TextAlignment="Center"
                                       Width="60"
                                       PreviewTextInput="CreditDays_PreviewTextInput"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellEditingTemplate>
                    </DataGridTemplateColumn>

                    <!-- Acciones -->
                    <DataGridTemplateColumn Header="ACCIONES" 
                              Width="90"
                              CanUserSort="False">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    

                                    <!-- Botón Eliminar/Cancelar -->
                                    <Button Content="🗑️"
                                           Tag="{Binding}"
                                           Click="DeleteButton_Click"
                                           Style="{StaticResource DangerButton}"
                                           Width="35"
                                           Height="30"
                                           Margin="2,0">
                                        <Button.ToolTip>
                                            <ToolTip>
                                                <ToolTip.Style>
                                                    <Style TargetType="ToolTip">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsNew}" Value="True">
                                                                <Setter Property="Content" Value="Cancelar"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsNew}" Value="False">
                                                                <Setter Property="Content" Value="Eliminar"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </ToolTip.Style>
                                            </ToolTip>
                                        </Button.ToolTip>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="#37474F" Height="35">
            <Grid Margin="15,0">
                <TextBlock Name="StatusText"
                         Text="Listo"
                         Foreground="#B0BEC5"
                         VerticalAlignment="Center"
                         FontSize="12"/>
                <TextBlock Name="CountText"
                         Text="0 proveedores"
                         Foreground="#B0BEC5"
                         VerticalAlignment="Center"
                         HorizontalAlignment="Right"
                         FontSize="12"/>
            </Grid>
        </Border>
    </Grid>
</Window>