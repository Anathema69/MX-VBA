<Window x:Class="SistemaGestionProyectos2.Views.VendorManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Gestión de Vendedores" 
        Height="800" 
        Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowState="Normal">

    <Window.Resources>
        <!-- Colores consistentes con el resto del proyecto -->
        <SolidColorBrush x:Key="PrimaryColor" Color="#6366F1"/>
        <SolidColorBrush x:Key="PrimaryLight" Color="#E0E7FF"/>
        <SolidColorBrush x:Key="SuccessColor" Color="#10B981"/>
        <SolidColorBrush x:Key="SuccessLight" Color="#D1FAE5"/>
        <SolidColorBrush x:Key="DangerColor" Color="#EF4444"/>
        <SolidColorBrush x:Key="DangerLight" Color="#FEE2E2"/>
        <SolidColorBrush x:Key="WarningColor" Color="#F59E0B"/>
        <SolidColorBrush x:Key="WarningLight" Color="#FEF3C7"/>
        <SolidColorBrush x:Key="InfoColor" Color="#3B82F6"/>
        <SolidColorBrush x:Key="InfoLight" Color="#DBEAFE"/>
        <SolidColorBrush x:Key="BackgroundGray" Color="#F9FAFB"/>
        <SolidColorBrush x:Key="BorderGray" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="TextGray" Color="#6B7280"/>
        <SolidColorBrush x:Key="DarkText" Color="#111827"/>

        <!-- Estilo para botones modernos -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="6" Direction="270" 
                                                ShadowDepth="1" Opacity="0.1"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo para botones secundarios -->
        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource DarkText}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderGray}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource BackgroundGray}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo para tarjetas -->
        <Style x:Key="VendorCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderGray}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="8" Direction="270" 
                                    ShadowDepth="1" Opacity="0.05"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect BlurRadius="12" Direction="270" 
                                            ShadowDepth="2" Opacity="0.1"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Estilo para botones de acción pequeños -->
        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="ToolTipService.InitialShowDelay" Value="500"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource BackgroundGray}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Background="{StaticResource BackgroundGray}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header compacto -->
        <Border Grid.Row="0" Background="White" BorderBrush="{StaticResource BorderGray}" 
                BorderThickness="0,0,0,1">
            <Grid Margin="24,14">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Vertical">
                    <TextBlock Text="GESTIÓN DE VENDEDORES" 
                             FontSize="20" 
                             FontWeight="Bold" 
                             Foreground="{StaticResource DarkText}"/>
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <Border Background="{StaticResource InfoLight}" 
                                CornerRadius="4" Padding="6,2" Margin="0,0,8,0">
                            <TextBlock Name="VendorCountBadge" 
                                     Text="0 activos" 
                                     FontSize="11" 
                                     FontWeight="Medium"
                                     Foreground="{StaticResource InfoColor}"/>
                        </Border>
                        <Border Background="{StaticResource SuccessLight}" 
                                CornerRadius="4" Padding="6,2">
                            <TextBlock Name="CommissionAvgBadge" 
                                     Text="Comisión promedio: 0%" 
                                     FontSize="11" 
                                     FontWeight="Medium"
                                     Foreground="{StaticResource SuccessColor}"/>
                        </Border>
                    </StackPanel>
                </StackPanel>

                <Button Grid.Column="1" 
                        Content="← Volver" 
                        Style="{StaticResource SecondaryButton}"
                        Click="CloseButton_Click"/>
            </Grid>
        </Border>

        <!-- Barra de herramientas compacta -->
        <Grid Grid.Row="1" Margin="24,12,24,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Búsqueda mejorada -->
            <Border Grid.Column="0" Background="White" 
                    CornerRadius="6" Width="280" BorderThickness="1"
                    BorderBrush="{StaticResource BorderGray}">
                <Grid>
                    <TextBox Name="SearchBox"
                           BorderThickness="0"
                           Background="Transparent"
                           Padding="32,8,8,8"
                           FontSize="13"
                           VerticalAlignment="Center"
                           TextChanged="SearchBox_TextChanged"/>
                    <TextBlock Text="🔍" 
                             Margin="10,0,0,0" 
                             VerticalAlignment="Center"
                             Foreground="{StaticResource TextGray}"
                             IsHitTestVisible="False"/>
                    <TextBlock Text="Buscar vendedor..." 
                             Margin="32,0,0,0"
                             VerticalAlignment="Center"
                             Foreground="{StaticResource TextGray}"
                             IsHitTestVisible="False">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Hidden"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Text.Length, ElementName=SearchBox}" Value="0">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Grid>
            </Border>

            <!-- Botón de nuevo vendedor -->
            <Button Grid.Column="2" Name="AddVendorButton"
                    Style="{StaticResource ModernButton}"
                    Click="AddVendor_Click">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="➕" FontSize="12" Margin="0,0,6,0"/>
                    <TextBlock Text="Nuevo Vendedor"/>
                </StackPanel>
            </Button>
        </Grid>

        <!-- Lista de vendedores con diseño de tarjetas -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" 
                      Margin="24,0,24,12">
            <ItemsControl Name="VendorsItemsControl">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource VendorCard}" Padding="16,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="1.5*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Avatar -->
                                <Border Grid.Column="0" Width="40" Height="40" 
                                        CornerRadius="20" Margin="0,0,12,0">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#667EEA" Offset="0"/>
                                            <GradientStop Color="#764BA2" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <TextBlock Text="{Binding AvatarInitial}" 
                                             FontSize="14" FontWeight="Bold"
                                             Foreground="White"
                                             HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"/>
                                </Border>

                                <!-- Nombre y usuario -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding VendorName}" 
                                             FontSize="14" FontWeight="SemiBold"
                                             Foreground="{StaticResource DarkText}"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                        <TextBlock Text="@" FontSize="11" 
                                                 Foreground="{StaticResource PrimaryColor}"/>
                                        <TextBlock Text="{Binding Username}" 
                                                 FontSize="11" 
                                                 Foreground="{StaticResource PrimaryColor}"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Email -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center" 
                                          Margin="12,0">
                                    <TextBlock Text="{Binding Email}" 
                                             FontSize="12" 
                                             Foreground="{StaticResource TextGray}"/>
                                    <TextBlock Text="{Binding Phone}" 
                                             FontSize="11" 
                                             Foreground="{StaticResource TextGray}"
                                             Margin="0,1,0,0"/>
                                </StackPanel>

                                <!-- Estado -->
                                <Border Grid.Column="3" 
                                        Background="{StaticResource SuccessLight}"
                                        CornerRadius="4" 
                                        Padding="8,4"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="ACTIVO" 
                                             FontSize="10" 
                                             FontWeight="Bold"
                                             Foreground="{StaticResource SuccessColor}"/>
                                </Border>

                                <!-- Comisión editable inline -->
                                <Border Grid.Column="4" 
                                        BorderBrush="{StaticResource BorderGray}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Margin="8,0"
                                        Background="White">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="💰" 
                                                 FontSize="12" Margin="8,0,2,0"
                                                 VerticalAlignment="Center"/>

                                        <TextBox Grid.Column="1"
                                               Name="CommissionTextBox"
                                               Text="{Binding CommissionRate, StringFormat={}{0:F1}}"
                                               FontSize="13" 
                                               FontWeight="Bold"
                                               Foreground="{StaticResource DarkText}"
                                               Background="Transparent" 
                                               BorderThickness="0"
                                               TextAlignment="Center"
                                               VerticalAlignment="Center"
                                               PreviewMouseDown="CommissionTextBox_PreviewMouseDown"
                                               KeyDown="CommissionTextBox_KeyDown"
                                               LostFocus="CommissionTextBox_LostFocus"
                                               PreviewTextInput="CommissionTextBox_PreviewTextInput"
                                               Tag="{Binding}"
                                               IsReadOnly="True"/>

                                        <TextBlock Grid.Column="2" Text="%" 
                                                 FontSize="12" 
                                                 FontWeight="Bold"
                                                 Margin="0,0,8,0"
                                                 Foreground="{StaticResource TextGray}"
                                                 VerticalAlignment="Center"/>
                                    </Grid>
                                </Border>

                                <!-- Acciones compactas -->
                                <StackPanel Grid.Column="5" Orientation="Horizontal" 
                                          VerticalAlignment="Center">
                                    <Button Style="{StaticResource IconButton}"
                                            Click="EditButton_Click"
                                            Tag="{Binding}"
                                            ToolTip="Editar vendedor">
                                        <TextBlock Text="✏️" FontSize="16"/>
                                    </Button>

                                    <!-- Ver detalles estará desactivado por ahora -->
                                    <!-- <Button Style="{StaticResource IconButton}"
                                            Click="ViewDetailsButton_Click"
                                            Tag="{Binding}"
                                            ToolTip="Ver detalles"
                                            Margin="4,0">
                                        <TextBlock Text="👁️" FontSize="16"/>
                                    </Button>
                                    -->

                                    <Button Style="{StaticResource IconButton}"
                                            Click="DeactivateButton_Click"
                                            Tag="{Binding}"
                                            ToolTip="Desactivar vendedor">
                                        <TextBlock Text="🚫" FontSize="16"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Mensaje cuando no hay vendedores -->
        <Border Grid.Row="2" 
                Name="EmptyStatePanel"
                Visibility="Collapsed"
                Margin="24,40"
                Padding="40"
                Background="White"
                CornerRadius="12"
                HorizontalAlignment="Center"
                VerticalAlignment="Top">
            <StackPanel>
                <TextBlock Text="📋" FontSize="48" 
                         HorizontalAlignment="Center"
                         Margin="0,0,0,16"/>
                <TextBlock Text="No hay vendedores registrados" 
                         FontSize="18" FontWeight="SemiBold"
                         HorizontalAlignment="Center"
                         Foreground="{StaticResource DarkText}"
                         Margin="0,0,0,8"/>
                <TextBlock Text="Agrega tu primer vendedor para comenzar" 
                         FontSize="14"
                         HorizontalAlignment="Center"
                         Foreground="{StaticResource TextGray}"
                         Margin="0,0,0,16"/>
                <Button Content="➕ Agregar Vendedor" 
                        Style="{StaticResource ModernButton}"
                        HorizontalAlignment="Center"
                        Click="AddVendor_Click"/>
            </StackPanel>
        </Border>

        <!-- Toast de Notificación mejorado -->
        <Border Grid.Row="2" Name="ToastNotification" 
               Visibility="Collapsed" 
               Background="{StaticResource DarkText}"
               CornerRadius="8" 
               Margin="24,0,0,24" 
               Padding="16,12"
               HorizontalAlignment="Left"
               VerticalAlignment="Bottom">
            <Border.Effect>
                <DropShadowEffect BlurRadius="16" Direction="270" 
                                ShadowDepth="4" Opacity="0.2"/>
            </Border.Effect>
            <StackPanel Orientation="Horizontal">
                <TextBlock Name="ToastIcon" Text="✓" FontSize="14" 
                         Foreground="White" Margin="0,0,10,0"/>
                <TextBlock Name="ToastMessage" Text="Cambios guardados" 
                         FontSize="13" Foreground="White"/>
            </StackPanel>
        </Border>

        <!-- Barra de estado inferior -->
        <Border Grid.Row="3" Background="White" 
                BorderThickness="0,1,0,0" 
                BorderBrush="{StaticResource BorderGray}" 
                Padding="24,10">
            <Grid>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="💡 Tip:" 
                             FontSize="11" 
                             FontWeight="SemiBold"
                             Foreground="{StaticResource WarningColor}"
                             Margin="0,0,4,0"/>
                    <TextBlock Text="Haz clic en el campo de comisión para editarlo rápidamente" 
                             FontSize="11" 
                             Foreground="{StaticResource TextGray}"/>
                </StackPanel>

                <TextBlock Name="LastUpdateText" 
                         Text="Última actualización: hace unos momentos" 
                         FontSize="11" 
                         Foreground="{StaticResource TextGray}"
                         HorizontalAlignment="Right"/>
            </Grid>
        </Border>
    </Grid>
</Window>