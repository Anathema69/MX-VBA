<Window x:Class="SistemaGestionProyectos2.Views.UserManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="GestiÃ³n de Usuarios"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        WindowStyle="None"
        ResizeMode="NoResize"
        MaxHeight="{x:Static SystemParameters.MaximizedPrimaryScreenHeight}"
        Loaded="Window_Loaded">

    

    <Window.Resources>
        <!-- Colores consistentes -->
        <SolidColorBrush x:Key="PrimaryColor" Color="#6366F1"/>
        <SolidColorBrush x:Key="PrimaryLight" Color="#E0E7FF"/>
        <SolidColorBrush x:Key="SuccessColor" Color="#10B981"/>
        <SolidColorBrush x:Key="SuccessLight" Color="#D1FAE5"/>
        <SolidColorBrush x:Key="DangerColor" Color="#EF4444"/>
        <SolidColorBrush x:Key="DangerLight" Color="#FEE2E2"/>
        <SolidColorBrush x:Key="WarningColor" Color="#F59E0B"/>
        <SolidColorBrush x:Key="WarningLight" Color="#FEF3C7"/>
        <SolidColorBrush x:Key="InfoColor" Color="#3B82F6"/>
        <SolidColorBrush x:Key="InfoLight" Color="#DBEAFE"/>
        <SolidColorBrush x:Key="BackgroundGray" Color="#F9FAFB"/>
        <SolidColorBrush x:Key="BorderGray" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="TextGray" Color="#6B7280"/>
        <SolidColorBrush x:Key="DarkText" Color="#111827"/>

        <!-- Estilo para botones modernos -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="6" Direction="270"
                                                ShadowDepth="1" Opacity="0.1"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo para botones secundarios -->
        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource DarkText}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderGray}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="14,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource BackgroundGray}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo para tarjetas -->
        <Style x:Key="UserCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderGray}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="8" Direction="270"
                                    ShadowDepth="1" Opacity="0.05"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect BlurRadius="12" Direction="270"
                                            ShadowDepth="2" Opacity="0.1"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Estilo para botones de acciÃ³n pequeÃ±os -->
        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="ToolTipService.InitialShowDelay" Value="500"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource BackgroundGray}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo para botÃ³n de desactivar (hover rojo) -->
        <Style x:Key="DangerIconButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="ToolTipService.InitialShowDelay" Value="500"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource DangerLight}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Background="{StaticResource BackgroundGray}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="White" BorderBrush="{StaticResource BorderGray}"
                BorderThickness="0,0,0,1">
            <Grid Margin="24,14">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Vertical">
                    <TextBlock Text="GESTIÃ“N DE USUARIOS"
                             FontSize="20"
                             FontWeight="Bold"
                             Foreground="{StaticResource DarkText}"/>
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <Border Background="{StaticResource InfoLight}"
                                CornerRadius="4" Padding="6,2" Margin="0,0,8,0">
                            <TextBlock Name="UserCountBadge"
                                     Text="0 usuarios"
                                     FontSize="11"
                                     FontWeight="Medium"
                                     Foreground="{StaticResource InfoColor}"/>
                        </Border>
                        <Border Background="{StaticResource SuccessLight}"
                                CornerRadius="4" Padding="6,2" Margin="0,0,8,0">
                            <TextBlock Name="ActiveCountBadge"
                                     Text="0 activos"
                                     FontSize="11"
                                     FontWeight="Medium"
                                     Foreground="{StaticResource SuccessColor}"/>
                        </Border>
                        <Border Background="{StaticResource DangerLight}"
                                CornerRadius="4" Padding="6,2">
                            <TextBlock Name="InactiveCountBadge"
                                     Text="0 inactivos"
                                     FontSize="11"
                                     FontWeight="Medium"
                                     Foreground="{StaticResource DangerColor}"/>
                        </Border>
                    </StackPanel>
                </StackPanel>

                <Button Grid.Column="1"
                        Content="â† Volver"
                        Style="{StaticResource SecondaryButton}"
                        Click="CloseButton_Click"/>
            </Grid>
        </Border>

        <!-- Barra de herramientas -->
        <Grid Grid.Row="1" Margin="24,12,24,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- BÃºsqueda -->
            <Border Grid.Column="0" Background="White"
                    CornerRadius="6" Width="280" BorderThickness="1"
                    BorderBrush="{StaticResource BorderGray}">
                <Grid>
                    <TextBox Name="SearchBox"
                           BorderThickness="0"
                           Background="Transparent"
                           Padding="32,8,8,8"
                           FontSize="13"
                           VerticalAlignment="Center"
                           TextChanged="SearchBox_TextChanged"/>
                    <TextBlock Text="ðŸ”"
                             Margin="10,0,0,0"
                             VerticalAlignment="Center"
                             Foreground="{StaticResource TextGray}"
                             IsHitTestVisible="False"/>
                    <TextBlock Text="Buscar usuario..."
                             Margin="32,0,0,0"
                             VerticalAlignment="Center"
                             Foreground="{StaticResource TextGray}"
                             IsHitTestVisible="False">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Hidden"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Text.Length, ElementName=SearchBox}" Value="0">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Grid>
            </Border>

            <!-- Filtro por rol -->
            <ComboBox Grid.Column="1" Name="RoleFilterCombo"
                      Width="180" Margin="12,0,0,0"
                      FontSize="13"
                      SelectionChanged="RoleFilter_Changed">
                <ComboBoxItem Content="Todos los roles" IsSelected="True"/>
                <ComboBoxItem Content="DirecciÃ³n" Tag="direccion"/>
                <ComboBoxItem Content="AdministraciÃ³n" Tag="administracion"/>
                <ComboBoxItem Content="Proyectos" Tag="proyectos"/>
                <ComboBoxItem Content="CoordinaciÃ³n" Tag="coordinacion"/>
                <ComboBoxItem Content="Ventas" Tag="ventas"/>
            </ComboBox>

            <!-- Checkbox mostrar inactivos -->
            <CheckBox Grid.Column="2" Name="ShowInactiveCheckbox"
                      Content="Mostrar inactivos"
                      Margin="16,0,0,0"
                      VerticalAlignment="Center"
                      FontSize="12"
                      Foreground="{StaticResource TextGray}"
                      Checked="ShowInactive_Changed"
                      Unchecked="ShowInactive_Changed"/>

            <!-- BotÃ³n de nuevo usuario -->
            <Button Grid.Column="3" Name="AddUserButton"
                    Style="{StaticResource ModernButton}"
                    Click="AddUser_Click">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="âž•" FontSize="12" Margin="0,0,6,0"/>
                    <TextBlock Text="Nuevo Usuario"/>
                </StackPanel>
            </Button>
        </Grid>

        <!-- Lista de usuarios -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto"
                      Margin="24,0,24,12">
            <ItemsControl Name="UsersItemsControl">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource UserCard}" Padding="16,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="1.5*"/>
                                    <ColumnDefinition Width="1.5*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Avatar -->
                                <Border Grid.Column="0" Width="44" Height="44"
                                        CornerRadius="22" Margin="0,0,14,0"
                                        Background="{Binding AvatarBackground}">
                                    <TextBlock Text="{Binding Initials}"
                                             FontSize="14" FontWeight="Bold"
                                             Foreground="White"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"/>
                                </Border>

                                <!-- Nombre y usuario -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding FullName}"
                                             FontSize="14" FontWeight="SemiBold"
                                             Foreground="{StaticResource DarkText}"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                        <TextBlock Text="@" FontSize="11"
                                                 Foreground="{StaticResource PrimaryColor}"/>
                                        <TextBlock Text="{Binding Username}"
                                                 FontSize="11"
                                                 Foreground="{StaticResource PrimaryColor}"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Email -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center"
                                          Margin="12,0">
                                    <TextBlock Text="{Binding Email}"
                                             FontSize="12"
                                             Foreground="{StaticResource TextGray}"
                                             TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Text="{Binding LastLoginDisplay}"
                                             FontSize="10"
                                             Foreground="{StaticResource TextGray}"
                                             Margin="0,2,0,0"/>
                                </StackPanel>

                                <!-- Rol -->
                                <Border Grid.Column="3"
                                        Background="{Binding RoleBackground}"
                                        CornerRadius="4"
                                        Padding="10,4"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="{Binding RoleDisplay}"
                                             FontSize="10"
                                             FontWeight="Bold"
                                             Foreground="{Binding RoleForeground}"/>
                                </Border>

                                <!-- Estado -->
                                <Border Grid.Column="4"
                                        Background="{Binding StatusBackground}"
                                        CornerRadius="4"
                                        Padding="10,4"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="{Binding StatusDisplay}"
                                             FontSize="10"
                                             FontWeight="Bold"
                                             Foreground="{Binding StatusForeground}"/>
                                </Border>

                                <!-- Acciones -->
                                <StackPanel Grid.Column="5" Orientation="Horizontal"
                                          VerticalAlignment="Center">
                                    <Button Style="{StaticResource IconButton}"
                                            Click="EditUser_Click"
                                            Tag="{Binding}"
                                            ToolTip="Editar usuario">
                                        <TextBlock Text="âœï¸" FontSize="16"/>
                                    </Button>

                                    <Button Style="{StaticResource IconButton}"
                                            Click="ChangePassword_Click"
                                            Tag="{Binding}"
                                            ToolTip="Cambiar contraseÃ±a"
                                            Margin="4,0">
                                        <TextBlock Text="ðŸ”‘" FontSize="16"/>
                                    </Button>

                                    <Button Style="{StaticResource DangerIconButton}"
                                            Click="ToggleStatus_Click"
                                            Tag="{Binding}"
                                            ToolTip="{Binding ToggleStatusTooltip}">
                                        <TextBlock Text="{Binding ToggleStatusIcon}" FontSize="16"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Mensaje cuando no hay usuarios -->
        <Border Grid.Row="2"
                Name="EmptyStatePanel"
                Visibility="Collapsed"
                Margin="24,40"
                Padding="40"
                Background="White"
                CornerRadius="12"
                HorizontalAlignment="Center"
                VerticalAlignment="Top">
            <StackPanel>
                <TextBlock Text="ðŸ‘¥" FontSize="48"
                         HorizontalAlignment="Center"
                         Margin="0,0,0,16"/>
                <TextBlock Text="No hay usuarios que mostrar"
                         FontSize="18" FontWeight="SemiBold"
                         HorizontalAlignment="Center"
                         Foreground="{StaticResource DarkText}"
                         Margin="0,0,0,8"/>
                <TextBlock Text="Ajusta los filtros o agrega un nuevo usuario"
                         FontSize="14"
                         HorizontalAlignment="Center"
                         Foreground="{StaticResource TextGray}"
                         Margin="0,0,0,16"/>
                <Button Content="âž• Agregar Usuario"
                        Style="{StaticResource ModernButton}"
                        HorizontalAlignment="Center"
                        Click="AddUser_Click"/>
            </StackPanel>
        </Border>

        <!-- Toast de NotificaciÃ³n -->
        <Border Grid.Row="2" Name="ToastNotification"
               Visibility="Collapsed"
               Background="{StaticResource SuccessColor}"
               CornerRadius="10"
               Margin="24,0,0,24"
               Padding="20,16"
               HorizontalAlignment="Left"
               VerticalAlignment="Bottom">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" Direction="270"
                                ShadowDepth="6" Opacity="0.3"/>
            </Border.Effect>
            <StackPanel Orientation="Horizontal">
                <TextBlock Name="ToastIcon" Text="âœ“" FontSize="20"
                         FontWeight="Bold"
                         Foreground="White" Margin="0,0,14,0"
                         VerticalAlignment="Center"/>
                <TextBlock Name="ToastMessage" Text="Cambios guardados"
                         FontSize="16" FontWeight="Medium"
                         Foreground="White"
                         VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Barra de estado inferior -->
        <Border Grid.Row="3" Background="White"
                BorderThickness="0,1,0,0"
                BorderBrush="{StaticResource BorderGray}"
                Padding="24,10">
            <Grid>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="ðŸ”’" FontSize="11" Margin="0,0,4,0"/>
                    <TextBlock Text="Solo usuarios con rol 'direccion' o 'administracion' pueden gestionar usuarios"
                             FontSize="11"
                             Foreground="{StaticResource TextGray}"/>
                </StackPanel>

                <TextBlock Name="StatusText"
                         Text=""
                         FontSize="11"
                         Foreground="{StaticResource TextGray}"
                         HorizontalAlignment="Right"/>
            </Grid>
        </Border>
    </Grid>
</Window>
